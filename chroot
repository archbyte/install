#!/bin/bash
echo
echo "Press 'Ctrl+c' to exit OR 'Enter' to continue"
read
#------------------------------------------------------------------------------------------------------------------------------------------
if [[ $EUID -ne 0 ]]; then
    echo "You must be a root user to run this." 2>&1
    exit 1
fi
#------------------------------------------------------------------------------------------------------------------------------------------
ln -s /hostlvm /run/lvm
#------------------------------------------------------------------------------------------------------------------------------------------
lsblk
read -p "efipartition (/dev/sdax) = " efipartition
echo $efipartition
echo
#------------------------------------------------------------------------------------------------------------------------------------------
read -p "Enter your preferred bootloader-id: " bootloaderid
echo
#------------------------------------------------------------------------------------------------------------------------------------------
read -p "Enter your hostname: " hostname
echo
#------------------------------------------------------------------------------------------------------------------------------------------
read -p "Enter your preferred username: " username
echo
#------------------------------------------------------------------------------------------------------------------------------------------
ln -sf /usr/share/zoneinfo/US/Pacific /etc/localtime
#------------------------------------------------------------------------------------------------------------------------------------------
hwclock --systohc --utc
#------------------------------------------------------------------------------------------------------------------------------------------
echo "nano /etc/locale.gen"
echo "Setting locale: en_US.UTF-8 UTF-8 for American-English."
sed -i '/#en_US.UTF-8 UTF-8/s/^#//g' /etc/locale.gen
echo
#------------------------------------------------------------------------------------------------------------------------------------------
echo "LANG=en_US.UTF-8"  > /etc/locale.conf
#------------------------------------------------------------------------------------------------------------------------------------------
locale-gen
echo
#------------------------------------------------------------------------------------------------------------------------------------------
echo "$hostname" > /etc/hostname
#------------------------------------------------------------------------------------------------------------------------------------------
echo "Enter root password."
passwd
echo
#------------------------------------------------------------------------------------------------------------------------------------------
mkdir /boot/efi
#------------------------------------------------------------------------------------------------------------------------------------------
mount $efipartition /boot/efi
echo
#------------------------------------------------------------------------------------------------------------------------------------------
pacman -S --needed intel-ucode grub efibootmgr os-prober sudo networkmanager
echo
#------------------------------------------------------------------------------------------------------------------------------------------
grub-install --target=x86_64-efi --efi-directory=/boot/efi --bootloader-id=$bootloaderid
echo
#------------------------------------------------------------------------------------------------------------------------------------------
sudo sed -i '4s/5/0/' /etc/default/grub
#grub-mkconfig -o /boot/grub/grub.cfg
sudo grub-mkconfig -o /boot/grub/grub.cfg
echo
#------------------------------------------------------------------------------------------------------------------------------------------
systemctl enable NetworkManager
#------------------------------------------------------------------------------------------------------------------------------------------
useradd -m -g users -G wheel -s /bin/bash $username
echo
#------------------------------------------------------------------------------------------------------------------------------------------
echo Enter your user password.
passwd $username
echo
#------------------------------------------------------------------------------------------------------------------------------------------
echo "Uncommenting the wheel group line."
sudo sed -i '/# %wheel ALL=(ALL) ALL/s/^#//g' /etc/sudoers
#------------------------------------------------------------------------------------------------------------------------------------------
mv /de /home/$username
mv /post /home/$username
#------------------------------------------------------------------------------------------------------------------------------------------
umount /run/lvm
echo "Reboot after exiting arch-chroot."
echo "Press enter to exit from chroot script."
read
umount -a
exit
